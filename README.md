# Backend for Allbiz Timesheet app

## Features

-   Stores employee timesheets in database.
-   Generates PDF timesheets and emails copy to payroll and employee.
-   Sends SMS reminders to employees.
-   Provides session-based authentication for web clients.
-   JSON:API for data entities.

## Server requirements

This app requires PHP `^7.2.5` and Composer.

In addition, your PHP installation must have the following extensions enabled:

-   `bcmath`
-   `ctype`
-   `fileinfo`
-   `json`
-   `mbstring`
-   `openssl`
-   `pdo`
-   `tokenizer`
-   `xml`

## Installation

1. Clone this repository to your server.
2. Run `composer install`.
3. Copy `.env.example` to `.env`.
4. Generate a unique app secret by running `php artisan key:generate`.

## Configuration

The app's configuration settings are set in `.env`.

### App settings

`APP_NAME`: The name of the app. Used for email and SMS messages.

`APP_ENV`: Then app's environment. Defaults to `production`. Set to local if running on a local server.

`APP_KEY`: The app's secret key, generated by running `php artisan key:generate`.

`APP_DEBUG`: Enables debugging features if set to `true`. Defaults to `false`.

`APP_URL`: The app's base URL e.g. `https://example.com`.

### Database settings (MySQL)

Example configuration for MySQL database running on server:

```ini
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE="DATABASE_NAME"
DB_USERNAME="DATABASE_USERNAME"
DB_PASSWORD="DATABASE_PASSWORD"
```

Example configuration for SQLite database.

```ini
DB_CONNECTION=sqlite
DB_DATABASE="/absolute/path/to/database.sqlite"
```

### Mail configuration

The example `.env` comes with example configuration for (mailtrap.io)[https://mailtrap.io], an SMTP testing service.

```ini
MAIL_MAILER=smtp
MAIL_HOST=smtp.mailtrap.io
MAIL_PORT=2525
MAIL_USERNAME="MAILTRAP_USERNAME"
MAIL_PASSWORD="MAILTRAP_USERNAME"
MAIL_ENCRYPTION=tls
MAIL_FROM_ADDRESS="fromaddress@example.com"
MAIL_FROM_NAME="${APP_NAME}"
```

Here is an example email configuration using `sendmail`, instead:

```ini
MAIL_MAILER=sendmail
MAIL_ENCRYPTION=tls
MAIL_FROM_ADDRESS="fromaddress@example.com"
MAIL_FROM_NAME="${APP_NAME}"
```

### SMS Configuration

This app sends SMS messages via (SMS Broadcast)[https://smsbroadcast.com.au/].

Example configuration for SMS:

```ini
SMSBROADCAST_USERNAME="SMSBROADCAST_USERNAME"
SMSBROADCAST_PASSWORD="SMSBROADCAST_PASSWORD"
SMSBROADCAST_FROM="Allbiz"
```

This is only required if you intend to use the `remind:users` console command.

### Security configuration

This app only accepts and authenticates requests from the app's domain.

Here is an example configuration including the required settings:

```ini
APP_DOMAIN="example.com"

SANCTUM_STATEFUL_DOMAINS="${APP_DOMAIN}"
XSRF_DOMAIN="${APP_DOMAIN}"
CORS_ALLOWED_ORIGINS="https://${APP_DOMAIN}"
```
